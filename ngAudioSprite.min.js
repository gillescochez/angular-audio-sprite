angular.module("ngAudioSprite.directive",[]).directive("audioSprite",["audioSprite",function(a){function b(){var a=k.length,b=0;if(!h.canPlayType)throw"ngAudioSprite: Browser not supported!";for(;a>b;b++)if(""!==h.canPlayType("audio/"+k[b]))return void(l=k[b])}function c(a,b){var c=document.createElement("source"),d="."+l,e=a.length,f=0;for(c.type="audio/"+l;e>f;f++)if(a[f].substr(-4)===d)return c.src=b+a[f],void h.appendChild(c)}function d(a){var b=a.split("/");return b.splice(b.length-1,1),b.join("/")+"/"}function e(){h.currentTime>=j.end&&h.pause()}function f(){angular.element(h).on("timeupdate",e)}function g(a){i[a]&&(j=i[a],h.currentTime=j.start,h.play())}var h,i={},j={},k=["ogg","m4a","mp3","ac3"],l="";return{restrict:"AEC",link:function(e,j,k){h=j[0],l||b(),f(),a.getSprite(k.audioSprite).success(function(b){i=b.spritemap,c(b.resources,d(k.audioSprite)),e.$watch(function(){return a.id},function(a){a&&g(a)})})}}}]),angular.module("ngAudioSprite",["ngAudioSprite.service","ngAudioSprite.directive"]),angular.module("ngAudioSprite.service",[]).factory("audioSprite",["$http",function(a){return{id:"",play:function(a){this.id=a},getSprite:function(b){return a.get(b)}}}]);
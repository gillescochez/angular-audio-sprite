angular.module("ngAudioSprite.directive",[]).directive("audioSprite",["audioSprite",function(a){function b(){var a=j.length,b=0;if(!g.canPlayType)throw"ngAudioSprite: Browser not supported!";for(;a>b;b++)if(""!==g.canPlayType("audio/"+j[b]))return void(k=j[b])}function c(a,b){var c=angular.element(g).children()[0]||document.createElement("source"),d="."+k,e=a.length,f=0;for(c.type&&c.type===k||(c.type="audio/"+k);e>f;f++)if(a[f].substr(-4)===d)return c.src||g.appendChild(c),void(c.src=b+a[f])}function d(){g.currentTime>=i.end&&g.pause()}function e(){angular.element(g).on("timeupdate",d)}function f(a){h[a]&&(i=h[a],g.currentTime=i.start,g.play())}var g,h={},i={},j=["ogg","m4a","mp3","ac3"],k="";return{restrict:"AEC",link:function(d,i){g=i[0],!k&&b(),e(),d.$watch(function(){return a.config},function(a){a.resources&&a.spritemap&&(c(a.resources,a.path),h=a.spritemap)}),d.$watch(function(){return a.id},function(a){a&&f(a)})}}}]),angular.module("ngAudioSprite",["ngAudioSprite.service","ngAudioSprite.directive"]),angular.module("ngAudioSprite.service",[]).factory("audioSprite",["$http",function(a){function b(a){var b=a.split("/");return b.splice(b.length-1,1),b.join("/")+"/"}return{id:"",config:{},play:function(a){this.id=a},load:function(c){var d=this;a.get(c).success(function(a){d.config=a,d.config.path=b(c)}).error(function(){throw"Failed to retrieve audio sprite configuration file: "+c})}}}]);